<html>
	<head>
		<!--script type="text/go">
		</script-->
		<title></title>
	</head>
	<body>
		<div style="margin-bottom: 20px;">Okay, cool, let's see what happens.</div>
		<pre id="out"></pre>
		<script type="text/go">
package main

import (
	"net/rpc/jsonrpc"
	"time"
	"fmt"

	//"github.com/gopherjs/gopherjs/js"
	"github.com/gopherjs/websocket"
	//"honnef.co/go/js/dom"
)

type Args struct {
	A, B int
}

var sock *websocket.Conn

func begin() { //gopherjs:blocking
	client := jsonrpc.NewClient(sock)

	started := time.Now()
	args := &Args{15, 3}
	var reply int
	{
		err := client.Call("Arith.Multiply", args, &reply) //gopherjs:blocking
		if err != nil {
			fmt.Println("arith error:", err)
		}
	} //gopherjs:blocking
	fmt.Printf("Arith: %d*%d=%d taken %v\n", args.A, args.B, reply, time.Since(started).String())

	err := client.Close()
	if err != nil {
		fmt.Println("client.Close():", err)
	}
} //gopherjs:blocking

func main() {
	var err error
	sock, err = websocket.Dial("ws://localhost:8081/rpc-websocket")
	if err != nil {
		panic(err)
	}
	//sock = websocket.New("ws://shurserv-no-ip.org:34600/status")

	/*sock.OnMessage(func(messageEvent *dom.MessageEvent) {
		println("received msg")
		println(messageEvent.Data.String())
	})*/

	/*sock.OnOpen(func(event js.Object) {
		//sock.Write([]byte(`{"method":"Arith.Multiply","params":[{"A":15,"B":4}],"id":0}`))

		go func() { //gopherjs:blocking
			begin() //gopherjs:blocking
		}() //gopherjs:blocking
	})*/

	begin()
}
		</script>
	</body>
</html>
